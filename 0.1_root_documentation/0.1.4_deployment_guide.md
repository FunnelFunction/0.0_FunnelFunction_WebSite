# Deployment Guide

> **0.1.4** - How to build and deploy the Funnel Function website

---

## Overview

```
GitHub Repo ──► GitHub Actions ──► Deploy Targets
                    │
                    ├──► GitHub Pages (simulators, static site)
                    └──► WordPress (content via iframe embeds)
```

---

## Architecture

| Component | Location | URL |
|-----------|----------|-----|
| Main Site | GitHub Pages | `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/` |
| Campaign Commander | GitHub Pages | `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/simulators/campaign-commander/` |
| Gating Function Lab | GitHub Pages | `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/simulators/gating-function-lab/` |
| Blog/Whitepapers | WordPress | `https://funnelfunction.com/` |
| f(x) Social Hub | GitHub Pages | `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/social/4.1_social_aggregator/` |

---

## Prerequisites

### Required Tools
- Node.js 20+
- Git

### Required Accounts
- GitHub (with repo access)
- WordPress.com (for content sync)

---

## Quick Start

### Local Development

```bash
# Clone the repository
git clone https://github.com/FunnelFunction/0.0_FunnelFunction_WebSite.git
cd 0.0_FunnelFunction_WebSite

# Run Campaign Commander locally
cd 5.0_simulators/5.1_simulator_campaign_commander
npm install
npm run dev
# Opens at http://localhost:5173

# Run Gating Function Lab locally
cd ../5.5_simulator_gating_function_lab
npm install
npm run dev
```

### Build for Production

```bash
# Build Campaign Commander
cd 5.0_simulators/5.1_simulator_campaign_commander
npm install
npm run build
# Output in dist/

# Build Gating Function Lab
cd ../5.5_simulator_gating_function_lab
npm install
npm run build
# Output in dist/
```

---

## GitHub Actions Deployment

### Automatic Deployment

Deployment happens automatically via GitHub Actions when you push to `main`:

```yaml
# .github/workflows/deploy-pages.yml
on:
  push:
    branches: [main]
```

### What Gets Deployed

1. **React Simulators** - Built with Vite, output to `dist/`
2. **Static Pages** - HTML from `1.0_pages_core/`
3. **Social Hub** - HTML from `4.0_social/`
4. **Main Index** - Root `index.html`

### Deployment Steps

1. Build Campaign Commander (React/Vite)
2. Build Gating Function Lab (React/Vite)
3. Copy static assets to `_site/`
4. Deploy `_site/` to GitHub Pages

---

## Manual Deployment

### Deploy to GitHub Pages

```bash
# Ensure you're on main branch
git checkout main

# Make your changes
git add -A
git commit -m "feat: update simulators"
git push origin main

# GitHub Actions will automatically deploy
```

### Check Deployment Status

1. Go to repository → Actions tab
2. Find "Deploy to GitHub Pages" workflow
3. Check run status

### Verify Deployment

After successful deployment:
- Main site: `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/`
- Campaign Commander: `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/simulators/campaign-commander/`
- Gating Function Lab: `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/simulators/gating-function-lab/`
- f(x) Social: `https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/social/4.1_social_aggregator/`

---

## WordPress Integration

### Embed Strategy

WordPress pages embed GitHub Pages content via iframes:

```html
<!-- On WordPress simulator page -->
<iframe
  src="https://funnelfunction.github.io/0.0_FunnelFunction_WebSite/simulators/campaign-commander/"
  width="100%"
  height="700"
  frameborder="0"
  title="Campaign Commander"
></iframe>
```

### Sync Documentation

See `8.0_scripts/8.1_script_wordpress_sync/8.1.0_README.md` for:
- WordPress API credentials setup
- Content export/import scripts
- Bidirectional sync strategy

---

## Vite Configuration

**Important:** For project sites (not user/org sites), the base path must include the repo name.

### Campaign Commander

```typescript
// 5.0_simulators/5.1_simulator_campaign_commander/vite.config.ts
export default defineConfig({
  plugins: [react()],
  base: '/0.0_FunnelFunction_WebSite/simulators/campaign-commander/',  // Include repo name!
  build: {
    outDir: 'dist',
    sourcemap: true,
  },
});
```

### Gating Function Lab

```typescript
// 5.0_simulators/5.5_simulator_gating_function_lab/vite.config.ts
export default defineConfig({
  plugins: [react()],
  base: '/0.0_FunnelFunction_WebSite/simulators/gating-function-lab/',  // Include repo name!
  build: {
    outDir: 'dist',
    sourcemap: true,
  },
});
```

---

## Environment Variables

### GitHub Secrets (for Actions)

| Secret | Description |
|--------|-------------|
| `WORDPRESS_ACCESS_TOKEN` | WordPress.com OAuth token |
| `WORDPRESS_SITE_ID` | Site ID (250554630) |

### Setting Secrets

1. Go to repository → Settings → Secrets and variables → Actions
2. Click "New repository secret"
3. Add each secret

---

## Troubleshooting

### Build Failures

| Error | Cause | Solution |
|-------|-------|----------|
| `Cannot find module 'react'` | Dependencies not installed | Run `npm install` |
| TypeScript errors | Type issues | Fix types or add `// @ts-ignore` |
| `ENOENT` | File not found | Check file paths |

### Deployment Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| 404 on simulator | Wrong base path | Check `vite.config.ts` base |
| Assets not loading | Path issues | Use relative paths |
| Old version showing | Browser cache | Hard refresh (Ctrl+Shift+R) |
| Workflow failed | Check Actions tab | Review error logs |

### GitHub Pages Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| Site not published | Pages not enabled | Settings → Pages → Enable |
| Wrong branch | Deploying from wrong branch | Check workflow trigger |
| CNAME issues | Custom domain config | Check DNS settings |

---

## URL Structure

```
funnelfunction.github.io/0.0_FunnelFunction_WebSite/
├── index.html                          # Main landing
├── simulators/
│   ├── campaign-commander/
│   │   └── index.html                  # React app (Campaign Commander)
│   └── gating-function-lab/
│       └── index.html                  # React app (Gating Function Lab)
├── social/
│   └── 4.1_social_aggregator/
│       └── index.html                  # f(x) Social - The Origin Hub
└── assets/                             # Static assets
```

---

## Rollback

### Revert to Previous Deployment

```bash
# Find previous commit
git log --oneline -10

# Revert to specific commit
git revert <commit-hash>
git push origin main

# GitHub Actions will redeploy
```

### Emergency: Manual Revert

```bash
# Force push previous version
git reset --hard HEAD~1
git push -f origin main  # Use with caution!
```

---

## Performance Checklist

- [ ] Simulators build without errors
- [ ] Assets are properly bundled
- [ ] Source maps generated (for debugging)
- [ ] HTTPS enforced on GitHub Pages
- [ ] Caching headers configured
- [ ] No console errors in production

---

*Last updated: 2025-12-11*
