# Deployment Guide

> **0.1.4** - How to build and deploy the Funnel Function website

---

## Overview

```
GitHub Repo ──► Build Process ──► Deploy Targets
                    │
                    ├──► WordPress (content sync)
                    ├──► GitHub Pages (simulators)
                    └──► Static assets
```

---

## Prerequisites

### Required Tools
- Python 3.10+
- Node.js 18+
- Git
- curl

### Required Accounts
- GitHub (with repo access)
- WordPress.com (OAuth configured)
- Social media APIs (optional)

### Environment Setup
```bash
# Clone the repository
git clone https://github.com/FunnelFunction/0.0_FunnelFunction_WebSite.git
cd 0.0_FunnelFunction_WebSite

# Copy environment template
cp 0.0_root_config/0.0.4_config_environment.env.example .env

# Edit .env with your credentials
nano .env

# Install Python dependencies
pip install -r requirements.txt

# Install Node dependencies (for simulators)
cd 5.0_simulators/5.1_simulator_campaign_commander
npm install
cd ../..
```

---

## Build Process

### 1. Build All
```bash
./8.0_scripts/8.1_build/8.1.0_build_all.sh
```

This will:
- Compile Markdown to HTML
- Build all simulators
- Generate SEO metadata
- Validate structure

### 2. Build Simulators Only
```bash
./8.0_scripts/8.1_build/8.1.1_build_simulators.sh
```

### 3. Build Static Pages Only
```bash
./8.0_scripts/8.1_build/8.1.2_build_static_pages.sh
```

---

## Deployment Targets

### A. GitHub Pages (Simulators)

```bash
./8.0_scripts/8.2_deploy/8.2.0_deploy_github_pages.sh
```

**What gets deployed:**
- Built simulator apps from `5.0_simulators/*/build/`
- Static assets from `7.0_assets/`

**URL Structure:**
- `https://funnelfunction.github.io/campaign-commander/`
- `https://funnelfunction.github.io/gating-function-lab/`

### B. WordPress Sync (Content)

```bash
./8.0_scripts/8.2_deploy/8.2.1_deploy_wordpress_sync.sh
```

**What gets synced:**
- Pages from `1.0_pages_core/`
- Whitepapers from `2.0_deep_knowledge/`
- Blog posts from `3.0_articles/`

**API Endpoints Used:**
- `POST /sites/{site_id}/posts/new` - Create
- `POST /sites/{site_id}/posts/{id}` - Update
- `GET /sites/{site_id}/posts` - List

---

## Manual Deployment Steps

### Deploy a Single Simulator

```bash
cd 5.0_simulators/5.1_simulator_campaign_commander

# Build
npm run build

# Deploy to GitHub Pages
npm run deploy
```

### Sync a Single Post to WordPress

```python
# Using the utility script
python 8.0_scripts/8.3_utilities/8.3.1_util_wordpress_export.py \
  --file "3.0_articles/3.1_blog_native/3.1.1_post_2025-12-07_death_of_trust.md" \
  --action "update" \
  --post-id 53
```

---

## Environment Variables Reference

```bash
# WordPress
WORDPRESS_SITE_ID=250554630
WORDPRESS_ACCESS_TOKEN=your_token

# GitHub
GITHUB_PERSONAL_ACCESS_TOKEN=your_pat

# Build
BUILD_ENV=production  # or development
DEPLOY_TARGET=all     # or wordpress, github-pages
```

---

## CI/CD (Future)

### GitHub Actions Workflow
```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Build
        run: ./8.0_scripts/8.1_build/8.1.0_build_all.sh

      - name: Deploy GitHub Pages
        run: ./8.0_scripts/8.2_deploy/8.2.0_deploy_github_pages.sh

      - name: Sync WordPress
        run: ./8.0_scripts/8.2_deploy/8.2.1_deploy_wordpress_sync.sh
        env:
          WORDPRESS_ACCESS_TOKEN: ${{ secrets.WORDPRESS_ACCESS_TOKEN }}
```

---

## Troubleshooting

### WordPress API Errors

| Error | Cause | Solution |
|-------|-------|----------|
| 401 Unauthorized | Token expired | Re-authenticate OAuth |
| 403 Forbidden | Insufficient permissions | Check app scopes |
| 429 Rate Limited | Too many requests | Add delays between calls |

### Build Failures

| Error | Cause | Solution |
|-------|-------|----------|
| Module not found | Missing dependency | `pip install -r requirements.txt` |
| ENOENT | File path wrong | Check naming conventions |
| TypeScript error | Type mismatch | Fix types, run `npm run typecheck` |

### GitHub Pages Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| 404 on deploy | Wrong base URL | Check `vite.config.ts` base |
| Assets missing | Path issues | Use relative paths |
| Old version showing | Cache | Hard refresh, clear cache |

---

## Rollback Procedures

### WordPress
```bash
# List recent posts
python 8.3_utilities/8.3.1_util_wordpress_export.py --action list

# Revert to previous version (uses git history)
git checkout HEAD~1 -- 3.0_articles/3.1_blog_native/3.1.1_post.md
./8.0_scripts/8.2_deploy/8.2.1_deploy_wordpress_sync.sh
```

### GitHub Pages
```bash
# Revert deployment
git revert HEAD
git push origin main
# GitHub Actions will redeploy
```

---

*Last updated: 2025-12-10*
