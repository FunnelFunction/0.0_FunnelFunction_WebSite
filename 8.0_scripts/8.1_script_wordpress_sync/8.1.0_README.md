# WordPress Sync

> **8.1_script_wordpress_sync** - Bidirectional sync between GitHub and WordPress

---

## Overview

This module handles synchronization between:
- **GitHub** (source of truth for code, equations, structure)
- **WordPress** (funnelfunction.com - public content delivery)

---

## Architecture

```
┌─────────────────┐          ┌─────────────────┐
│                 │          │                 │
│     GitHub      │◄────────►│   WordPress     │
│  (Source Code)  │   SYNC   │ (Public Site)   │
│                 │          │                 │
└─────────────────┘          └─────────────────┘
        │                            │
        │                            │
        ▼                            ▼
┌─────────────────┐          ┌─────────────────┐
│  GitHub Pages   │          │ funnelfunction  │
│   (Simulators)  │          │     .com        │
└─────────────────┘          └─────────────────┘
```

---

## Sync Strategy

### What Lives Where

| Content Type | Primary Location | Synced To |
|-------------|------------------|-----------|
| Whitepapers (text) | WordPress | GitHub (markdown backup) |
| Blog posts | WordPress | GitHub (markdown backup) |
| Simulators (React) | GitHub | WordPress (iframe embed) |
| Equations (Python) | GitHub | — (code only) |
| Social Hub | GitHub | WordPress (iframe or link) |
| Assets (images) | WordPress Media | GitHub (reference only) |

### Sync Direction

| Direction | Trigger | Action |
|-----------|---------|--------|
| WP → GitHub | Manual / Webhook | Export posts to markdown |
| GitHub → WP | GitHub Action | Update embeds, notify |

---

## WordPress API Credentials

```bash
# OAuth2 credentials (stored in GitHub Secrets)
WORDPRESS_CLIENT_ID=129784
WORDPRESS_CLIENT_SECRET=<secret>
WORDPRESS_ACCESS_TOKEN=<token>
WORDPRESS_SITE_ID=250554630
```

---

## Sync Scripts

### Export WordPress to GitHub

```python
# 8.1.1_export_wordpress.py
import requests
import os

API_BASE = "https://public-api.wordpress.com/rest/v1.1"
SITE_ID = os.environ.get("WORDPRESS_SITE_ID")
TOKEN = os.environ.get("WORDPRESS_ACCESS_TOKEN")

def export_posts():
    """Export all WordPress posts to GitHub markdown."""
    headers = {"Authorization": f"Bearer {TOKEN}"}
    response = requests.get(
        f"{API_BASE}/sites/{SITE_ID}/posts",
        headers=headers,
        params={"number": 100}
    )
    posts = response.json().get("posts", [])

    for post in posts:
        filename = f"3.0_articles/3.1_blog_native/{post['slug']}.md"
        content = f"# {post['title']}\n\n{post['content']}"
        # Write to file...
```

### Update WordPress Embed URLs

```python
# 8.1.2_update_embeds.py
def update_simulator_embeds():
    """Update WordPress pages with new simulator URLs."""
    # After GitHub Pages deployment, update WordPress
    # to point to new simulator versions
    pass
```

---

## GitHub Action for Sync

```yaml
# .github/workflows/wordpress-sync.yml
name: WordPress Sync

on:
  schedule:
    - cron: '0 0 * * *'  # Daily at midnight
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Export WordPress content
        env:
          WORDPRESS_ACCESS_TOKEN: ${{ secrets.WORDPRESS_ACCESS_TOKEN }}
          WORDPRESS_SITE_ID: ${{ secrets.WORDPRESS_SITE_ID }}
        run: |
          pip install requests
          python 8.0_scripts/8.1_script_wordpress_sync/8.1.1_export_wordpress.py

      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add -A
          git diff --staged --quiet || git commit -m "sync: import WordPress content"
          git push
```

---

## Manual Sync Commands

### Export from WordPress

```bash
# Export all posts
python 8.1.1_export_wordpress.py --all

# Export single post
python 8.1.1_export_wordpress.py --slug "mint-mobile-case-study"

# Export pages
python 8.1.1_export_wordpress.py --type page
```

### Push to WordPress

```bash
# Update simulator embed on WordPress
python 8.1.2_update_embeds.py --page "simulators" --url "https://funnelfunction.github.io/simulators/"
```

---

## Embed Strategy

WordPress pages embed GitHub Pages content:

```html
<!-- On WordPress simulator page -->
<div class="simulator-wrapper">
  <h2>Campaign Commander</h2>
  <p>Control marketing variables and see real-time conversion calculations.</p>

  <!-- GitHub Pages iframe -->
  <iframe
    src="https://funnelfunction.github.io/simulators/campaign-commander/"
    width="100%"
    height="700"
    frameborder="0"
    title="Campaign Commander Simulator"
  ></iframe>

  <p><a href="https://github.com/FunnelFunction/0.0_FunnelFunction_WebSite/tree/main/5.0_simulators">
    View source code on GitHub
  </a></p>
</div>
```

---

## Metadata Tracking

Each imported file includes sync metadata:

```yaml
---
source: wordpress
post_id: 12345
last_synced: 2025-12-11T00:00:00Z
wordpress_url: https://funnelfunction.com/2025/12/05/mint-mobile/
---
```

---

## Conflict Resolution

1. **WordPress is authoritative** for blog content
2. **GitHub is authoritative** for code/equations
3. Manual edits to synced markdown will be overwritten on next sync
4. To preserve edits, make them in WordPress first

---

## Setup Instructions

### 1. Store Credentials in GitHub Secrets

```
Settings → Secrets and variables → Actions → New repository secret

- WORDPRESS_CLIENT_ID
- WORDPRESS_CLIENT_SECRET
- WORDPRESS_ACCESS_TOKEN
- WORDPRESS_SITE_ID
```

### 2. Enable GitHub Actions

Actions should run automatically on push and schedule.

### 3. Configure WordPress

Add Custom HTML block for simulator embeds on relevant pages.

---

*Last updated: 2025-12-11*
